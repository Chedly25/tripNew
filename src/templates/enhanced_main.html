<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Road Trip Planner - Your AI-Powered European Adventure</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/static/logo.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/logo.svg">
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="/static/logo.svg">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="/static/logo.svg">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" onerror="this.onerror=null; document.head.appendChild(document.createElement('link')).href='/static/fallback.css';">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Global Theme -->
    <link rel="stylesheet" href="/static/global-theme.css?v=2025-magical">
    <!-- Fallback CSS -->
    <link rel="stylesheet" href="/static/fallback.css">
    
    <style>
        /* Use global theme variables with enhancements */
        :root {
            /* Additional landing page specific gradients */
            --hero-gradient: linear-gradient(135deg, var(--brand-primary) 0%, var(--brand-secondary) 50%, var(--brand-accent) 100%);
            --glass-strong: rgba(255, 255, 255, 0.15);
            --glass-stronger: rgba(255, 255, 255, 0.25);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-primary);
            background: var(--hero-gradient);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }
        
        /* Floating background animations */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 107, 107, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(54, 207, 201, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 193, 7, 0.1) 0%, transparent 50%);
            pointer-events: none;
            animation: float 20s ease-in-out infinite;
            z-index: -1;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-10px) rotate(1deg); }
            66% { transform: translateY(5px) rotate(-1deg); }
        }
        
        /* Enhanced Navigation with Theme Colors */
        .navbar {
            background: var(--bg-glass);
            backdrop-filter: blur(30px);
            border-bottom: var(--border-glass);
            padding: 1rem 0;
            box-shadow: var(--shadow-glass);
        }
        
        .navbar-brand {
            font-family: var(--font-heading);
            font-weight: 700;
            color: var(--white) !important;
            font-size: 1.5rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 600;
            transition: var(--transition-normal);
            padding: 0.75rem 1.25rem !important;
            border-radius: var(--border-radius-lg);
        }
        
        .nav-link:hover, .nav-link.active {
            color: var(--white) !important;
            background: var(--bg-glass);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: var(--brand-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: var(--shadow-md);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Hero Section */
        .hero-section {
            background: transparent;
            color: white;
            padding: 4rem 0;
            text-align: center;
            position: relative;
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .hero-title {
            font-family: var(--font-heading);
            font-size: clamp(3rem, 6vw, 5rem);
            font-weight: 800;
            margin-bottom: 1.5rem;
            text-shadow: 0 6px 30px rgba(0,0,0,0.4);
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--white) 0%, rgba(255,255,255,0.8) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero-subtitle {
            font-size: clamp(1.1rem, 2.5vw, 1.4rem);
            opacity: 0.95;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .hero-features {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }
        
        .hero-feature {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }
        
        .hero-feature i {
            color: var(--brand-accent);
            font-size: 1.2rem;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            background: var(--bg-glass);
            border: 2px solid var(--border-glass);
            color: var(--white);
            padding: 1rem 2rem;
            border-radius: var(--border-radius-xl);
            font-weight: 700;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: var(--transition-smooth);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-glass);
            font-size: 1.1rem;
        }
        
        .quick-action-btn:hover {
            background: var(--glass-stronger);
            color: var(--white);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--shadow-xl);
        }
        
        .quick-action-btn.primary {
            background: var(--brand-gradient);
            color: var(--white);
            border-color: transparent;
            box-shadow: var(--shadow-brand);
        }
        
        .quick-action-btn.primary:hover {
            background: var(--brand-gradient-hover);
            color: var(--white);
            transform: translateY(-6px) scale(1.05);
            box-shadow: var(--shadow-brand-hover);
        }
        
        /* Enhanced Trip Planner Form */
        .planner-section {
            padding: 4rem 0;
        }
        
        .planner-card {
            background: var(--bg-glass);
            border-radius: var(--border-radius-xxl);
            padding: 3rem;
            box-shadow: var(--shadow-glass);
            border: var(--border-glass);
            backdrop-filter: blur(30px);
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }
        
        .planner-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -50%;
            width: 200%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 2s;
        }
        
        .planner-card:hover::before {
            transform: translateX(100%);
        }
        
        .planner-title {
            font-family: var(--font-heading);
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 2.5rem;
            color: var(--white);
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .form-group {
            margin-bottom: 2rem;
        }
        
        .form-label {
            font-weight: 700;
            color: var(--white);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.1rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .form-control, .form-select {
            border: 2px solid var(--border-glass);
            border-radius: var(--border-radius-xl);
            padding: 1.25rem 1.5rem;
            font-size: 1.1rem;
            transition: var(--transition-smooth);
            background: var(--bg-glass);
            color: var(--white);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
        }
        
        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--brand-accent);
            box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.3);
            background: var(--glass-stronger);
            color: var(--white);
            transform: translateY(-2px);
        }
        
        .route-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .route-type-card {
            background: var(--bg-card);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius-xl);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(20px);
        }
        
        .route-type-card:hover {
            background: var(--style-bg);
            transform: translateY(-6px) scale(1.02);
            box-shadow: var(--shadow-xl);
            border-color: var(--style-color);
        }
        
        .route-type-card.selected {
            border-color: var(--style-color);
            background: var(--style-bg);
            transform: translateY(-4px);
            box-shadow: var(--shadow-brand);
        }
        
        .route-type-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--border-radius-lg);
            background: var(--style-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.8rem;
            margin: 0 auto 1rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition-smooth);
        }
        
        .route-type-name {
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            font-size: 1.2rem;
        }
        
        .route-type-desc {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
            font-weight: 500;
        }
        
        .plan-btn {
            background: var(--brand-gradient);
            border: none;
            color: var(--white);
            padding: 1.5rem 3rem;
            border-radius: var(--border-radius-xxl);
            font-weight: 800;
            font-size: 1.2rem;
            width: 100%;
            margin-top: 2rem;
            transition: var(--transition-smooth);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-brand);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .plan-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .plan-btn:hover::before {
            left: 100%;
        }
        
        .plan-btn:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: var(--shadow-brand-hover);
            background: var(--brand-gradient-hover);
        }
        
        .plan-btn:active {
            transform: translateY(-2px) scale(0.98);
        }
        
        .plan-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Recent Trips Section */
        .recent-trips-section {
            padding: 3rem 0;
        }
        
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2rem;
            color: white;
        }
        
        .trips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .trip-card {
            background: var(--glass-bg);
            border-radius: 20px;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transition: all 0.2s ease;
        }
        
        .trip-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.15);
        }
        
        .trip-title {
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 0.5rem;
        }
        
        .trip-route {
            color: var(--gray-600);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .trip-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .trip-stat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--gray-600);
            font-size: 0.8rem;
        }
        
        .trip-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-primary-sm {
            background: var(--primary);
            color: white;
        }
        
        .btn-outline-sm {
            background: transparent;
            color: var(--gray-600);
            border: 1px solid var(--gray-300);
        }
        
        .btn-sm:hover {
            transform: translateY(-1px);
        }
        
        /* Photo Upload Section */
        .photo-inspiration {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .photo-upload {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .photo-upload:hover {
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .photo-upload i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.7;
        }
        
        /* Loading States */
        .loading {
            display: none;
        }
        
        .loading.active {
            display: inline-block;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Trip History & Memory Styles */
        .trip-history-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }
        
        .history-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .history-tab {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .history-tab:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .history-tab.active {
            background: var(--primary);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
        }
        
        .history-content {
            min-height: 200px;
        }
        
        .history-tab-content {
            display: none;
        }
        
        .history-tab-content.active {
            display: block;
        }
        
        .trip-preparation-item, .search-history-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .trip-preparation-item:hover, .search-history-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .trip-preparation-item h4, .search-history-item h4 {
            color: white;
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }
        
        .trip-preparation-item p, .search-history-item p {
            color: rgba(255, 255, 255, 0.8);
            margin: 0 0 0.5rem 0;
        }
        
        .trip-preparation-item small, .search-history-item small {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
        }
        
        .memory-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .memory-notification.show {
            opacity: 1;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-features {
                flex-direction: column;
                gap: 1rem;
            }
            
            .planner-card {
                padding: 2rem 1.5rem;
                margin: 0 1rem;
            }
            
            .route-types {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .user-menu {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Enhanced Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-route me-2"></i>
                Road Trip Planner
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav me-auto">
                    <a class="nav-link active" href="/">Home</a>
                    <a class="nav-link" href="/ai-assistant">
                        <i class="fas fa-robot me-1"></i>
                        AI Assistant
                    </a>
                    {% if current_user %}
                        <a class="nav-link" href="/travel-insights">
                            <i class="fas fa-chart-line me-1"></i>
                            My Insights
                        </a>
                    {% endif %}
                </div>
                
                <div class="user-menu">
                    {% if current_user %}
                        <div class="user-avatar">
                            {{ current_user.username[0].upper() }}
                        </div>
                        <div class="dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                {{ current_user.first_name or current_user.username }}
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/auth/profile">
                                    <i class="fas fa-user me-2"></i>Profile
                                </a></li>
                                <li><a class="dropdown-item" href="/travel-insights">
                                    <i class="fas fa-chart-line me-2"></i>Travel Insights
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="/auth/logout">
                                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                                </a></li>
                            </ul>
                        </div>
                    {% else %}
                        <a class="nav-link" href="/auth/login">Login</a>
                        <a class="nav-link" href="/auth/register">Sign Up</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Enhanced Hero Section -->
    <div class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">
                    Discover Europe Through Intelligent Travel Design
                </h1>
                <p class="hero-subtitle">
                    Experience the next generation of travel planning with our AI-powered platform. We craft 
                    sophisticated journeys through Europe's most captivating destinations, seamlessly blending 
                    renowned landmarks with authentic hidden treasures. From curated cultural odysseys to 
                    romantic escapes—each route is intelligently designed for the discerning traveler.
                </p>
                
                <div class="hero-features">
                    <div class="hero-feature">
                        <i class="fas fa-brain"></i>
                        <span>AI-Powered Route Intelligence</span>
                    </div>
                    <div class="hero-feature">
                        <i class="fas fa-gem"></i>
                        <span>Six Curated Journey Styles</span>
                    </div>
                    <div class="hero-feature">
                        <i class="fas fa-compass"></i>
                        <span>Real-Time Personalization</span>
                    </div>
                    <div class="hero-feature">
                        <i class="fas fa-route"></i>
                        <span>Seamless Trip Orchestration</span>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <a href="/ai-travel-planner" class="quick-action-btn primary">
                        <i class="fas fa-wand-magic-sparkles"></i>
                        🎯 Get AI Travel Suggestions Now!
                    </a>
                    <a href="/ai-assistant" class="quick-action-btn">
                        <i class="fas fa-robot"></i>
                        💬 Chat with Claude AI
                    </a>
                    <a href="#planner" class="quick-action-btn">
                        <i class="fas fa-rocket"></i>
                        🚀 Start Planning Adventure
                    </a>
                    {% if not current_user %}
                        <a href="/auth/register" class="quick-action-btn">
                            <i class="fas fa-user-plus"></i>
                            🎉 Join the Adventure!
                        </a>
                    {% endif %}
                </div>
                
                <!-- Photo Inspiration -->
                <div class="photo-inspiration">
                    <h3 style="color: white; margin-bottom: 1rem;">
                        <i class="fas fa-camera me-2"></i>
                        Get Inspired by Photos
                    </h3>
                    <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                        <i class="fas fa-cloud-upload-alt" style="color: white;"></i>
                        <p style="color: white; margin: 0;">
                            Upload a photo and let AI suggest similar European destinations
                        </p>
                        <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="analyzePhoto(this)">
                    </div>
                </div>
                
                <!-- Trip History & Preparations -->
                <div class="trip-history-section" style="margin-top: 2rem;">
                    <h3 style="color: white; margin-bottom: 1rem;">
                        <i class="fas fa-history me-2"></i>
                        Your Trip History
                    </h3>
                    <div class="history-tabs">
                        <button class="history-tab active" onclick="showHistoryTab('preparations')">
                            <i class="fas fa-drafting-compass me-2"></i>
                            Preparations
                        </button>
                        <button class="history-tab" onclick="showHistoryTab('searches')">
                            <i class="fas fa-search me-2"></i>
                            Search History
                        </button>
                    </div>
                    <div id="historyContent" class="history-content">
                        <div id="preparationsTab" class="history-tab-content active">
                            <div id="tripPreparationsContainer">
                                <p style="color: rgba(255,255,255,0.7); text-align: center;">
                                    Start planning a trip to see your preparations here
                                </p>
                            </div>
                        </div>
                        <div id="searchesTab" class="history-tab-content">
                            <div id="searchHistoryContainer">
                                <p style="color: rgba(255,255,255,0.7); text-align: center;">
                                    Your search history will appear here
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Trips for Logged-in Users -->
    {% if current_user and recent_trips %}
    <div class="recent-trips-section">
        <div class="container">
            <h2 class="section-title">
                <i class="fas fa-history me-2"></i>
                Your Recent Adventures
            </h2>
            
            <div class="trips-grid">
                {% for trip in recent_trips %}
                <div class="trip-card">
                    <h4 class="trip-title">{{ trip.trip_name }}</h4>
                    <p class="trip-route">{{ trip.start_city }} → {{ trip.end_city }}</p>
                    
                    <div class="trip-stats">
                        <div class="trip-stat">
                            <i class="fas fa-route"></i>
                            {{ "%.0f"|format(trip.total_distance) }}km
                        </div>
                        <div class="trip-stat">
                            <i class="fas fa-clock"></i>
                            {{ "%.1f"|format(trip.total_duration) }}h
                        </div>
                        <div class="trip-stat">
                            <i class="fas fa-euro-sign"></i>
                            €{{ "%.0f"|format(trip.estimated_cost) }}
                        </div>
                    </div>
                    
                    <div class="trip-actions">
                        <button class="btn-sm btn-primary-sm" onclick="loadTrip({{ trip.id }})">
                            <i class="fas fa-eye me-1"></i>View
                        </button>
                        <button class="btn-sm btn-outline-sm" onclick="toggleFavorite({{ trip.id }})">
                            <i class="fas fa-heart{{ ' text-danger' if trip.is_favorite else '' }}"></i>
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Enhanced Trip Planner -->
    <div class="planner-section" id="planner">
        <div class="container">
            <div class="planner-card">
                <h2 class="planner-title">
                    <i class="fas fa-wand-magic-sparkles me-2"></i>
                    🎨 Create Your Magical Journey
                </h2>
                
                <form id="tripPlannerForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="startLocation" class="form-label">
                                    <i class="fas fa-play-circle"></i>
                                    Starting City
                                </label>
                                <input type="text" class="form-control" id="startLocation" 
                                       placeholder="e.g., Aix-en-Provence" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="endLocation" class="form-label">
                                    <i class="fas fa-flag-checkered"></i>
                                    Destination City
                                </label>
                                <input type="text" class="form-control" id="endLocation" 
                                       placeholder="e.g., Venice" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-route"></i>
                            Choose Your Adventure Types
                        </label>
                        <div class="route-types">
                            <div class="route-type-card trip-scenic" data-type="scenic">
                                <div class="route-type-icon">
                                    <i class="fas fa-mountain"></i>
                                </div>
                                <div class="route-type-name">🏔️ Scenic</div>
                                <div class="route-type-desc">Breathtaking landscapes and natural wonders that'll take your breath away!</div>
                            </div>
                            <div class="route-type-card trip-cultural" data-type="cultural">
                                <div class="route-type-icon">
                                    <i class="fas fa-monument"></i>
                                </div>
                                <div class="route-type-name">🏰 Cultural</div>
                                <div class="route-type-desc">Historic sites and cultural landmarks rich with stories and legends</div>
                            </div>
                            <div class="route-type-card trip-adventure" data-type="adventure">
                                <div class="route-type-icon">
                                    <i class="fas fa-hiking"></i>
                                </div>
                                <div class="route-type-name">🏄 Adventure</div>
                                <div class="route-type-desc">Thrilling activities and outdoor experiences for adrenaline seekers!</div>
                            </div>
                            <div class="route-type-card trip-culinary" data-type="culinary">
                                <div class="route-type-icon">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <div class="route-type-name">🍽️ Culinary</div>
                                <div class="route-type-desc">Gastronomic delights and local cuisine that'll make you fall in love</div>
                            </div>
                            <div class="route-type-card trip-romantic" data-type="romantic">
                                <div class="route-type-icon">
                                    <i class="fas fa-heart"></i>
                                </div>
                                <div class="route-type-name">💕 Romantic</div>
                                <div class="route-type-desc">Perfect for couples seeking magical moments and romantic getaways</div>
                            </div>
                            <div class="route-type-card trip-hidden_gems" data-type="hidden_gems">
                                <div class="route-type-icon">
                                    <i class="fas fa-gem"></i>
                                </div>
                                <div class="route-type-name">💎 Hidden Gems</div>
                                <div class="route-type-desc">Secret spots and off-the-beaten-path treasures few travelers know!</div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="plan-btn">
                        <span class="btn-text">
                            <i class="fas fa-wand-magic-sparkles me-2"></i>
                            ✨ Create My Magical AI Adventure! ✨
                        </span>
                        <span class="loading">
                            <span class="spinner"></span>
                            🤖 Claude AI is crafting your perfect adventure...
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Floating AI Chat Widget -->
    <div class="floating-ai-chat" id="aiChatWidget">
        <div class="chat-toggle" onclick="toggleAiChat()">
            <i class="fas fa-robot"></i>
            <div class="chat-pulse"></div>
        </div>
        <div class="chat-panel" id="aiChatPanel">
            <div class="chat-header">
                <div class="chat-title">
                    <i class="fas fa-robot me-2"></i>
                    🤖 Claude Travel Assistant
                </div>
                <button class="chat-close" onclick="toggleAiChat()">×</button>
            </div>
            <div class="chat-messages" id="aiChatMessages">
                <div class="ai-message">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        👋 Hi! I'm Claude, your AI travel companion! I can help you plan amazing European adventures, suggest destinations, or answer any travel questions. What's your dream trip?
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" class="chat-input" id="aiChatInput" placeholder="Ask me about European destinations..." onkeypress="handleChatKeyPress(event)">
                <button class="chat-send" onclick="sendAiMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/memory-manager.js"></script>
    
    <script>
        // Route type selection
        let selectedRouteTypes = ['scenic', 'cultural']; // Default selection
        
        document.querySelectorAll('.route-type-card').forEach(card => {
            card.addEventListener('click', function() {
                const type = this.dataset.type;
                
                if (this.classList.contains('selected')) {
                    // Deselect if already selected
                    this.classList.remove('selected');
                    selectedRouteTypes = selectedRouteTypes.filter(t => t !== type);
                } else {
                    // Select if not selected
                    this.classList.add('selected');
                    if (!selectedRouteTypes.includes(type)) {
                        selectedRouteTypes.push(type);
                    }
                }
                
                // Ensure at least one is selected
                if (selectedRouteTypes.length === 0) {
                    selectedRouteTypes = ['scenic'];
                    document.querySelector('[data-type="scenic"]').classList.add('selected');
                }
            });
        });
        
        // Initialize default selections
        document.querySelector('[data-type="scenic"]').classList.add('selected');
        document.querySelector('[data-type="cultural"]').classList.add('selected');
        
        // Enhanced form submission
        document.getElementById('tripPlannerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const startLocation = document.getElementById('startLocation').value.trim();
            const endLocation = document.getElementById('endLocation').value.trim();
            
            if (!startLocation || !endLocation) {
                alert('Please enter both starting city and destination');
                return;
            }
            
            if (selectedRouteTypes.length === 0) {
                alert('Please select at least one route type');
                return;
            }
            
            // Show loading state
            const button = document.querySelector('.plan-btn');
            const btnText = button.querySelector('.btn-text');
            const loading = button.querySelector('.loading');
            
            button.disabled = true;
            btnText.style.display = 'none';
            loading.classList.add('active');
            
            try {
                const response = await fetch('/api/plan-trip', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        start_location: startLocation,
                        end_location: endLocation,
                        route_types: selectedRouteTypes
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success !== false) {
                    // Store results and navigate
                    sessionStorage.setItem('travelPlanResult', JSON.stringify({
                        success: true,
                        data: data
                    }));
                    
                    window.location.href = '/results';
                } else {
                    throw new Error(data.error || 'Planning failed');
                }
                
            } catch (error) {
                console.error('Trip planning error:', error);
                alert('Sorry, we encountered an error while planning your trip. Please try again.');
            } finally {
                // Hide loading state
                button.disabled = false;
                btnText.style.display = 'inline';
                loading.classList.remove('active');
            }
        });
        
        // Photo analysis function
        async function analyzePhoto(input) {
            const file = input.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please upload a valid image file.');
                return;
            }
            
            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('Please upload an image smaller than 10MB.');
                return;
            }
            
            // Show loading state
            const originalText = document.querySelector('.photo-upload p').textContent;
            document.querySelector('.photo-upload p').textContent = 'Analyzing your photo with AI...';
            document.querySelector('.photo-upload i').className = 'fas fa-spinner fa-spin';
            
            try {
                // Convert image to base64
                const base64Image = await convertImageToBase64(file);
                
                const response = await fetch('/api/ai-photo-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        image_data: base64Image,
                        image_type: file.type 
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.destinations) {
                    // Show results in a beautiful modal instead of alert
                    showPhotoAnalysisResults(data.destinations);
                } else {
                    showErrorModal('AI photo analysis failed. Please try uploading a clearer image of a travel destination.');
                }
                
            } catch (error) {
                console.error('Photo analysis error:', error);
                showErrorModal('Photo analysis service is currently unavailable. Please try again later.');
            } finally {
                // Reset UI state
                document.querySelector('.photo-upload p').textContent = originalText;
                document.querySelector('.photo-upload i').className = 'fas fa-cloud-upload-alt';
                // Clear the file input
                input.value = '';
            }
        }
        
        // Helper function to convert image to base64
        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    // Remove the data URL prefix (data:image/jpeg;base64,)
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // Trip management functions
        function loadTrip(tripId) {
            // This would load trip details - for now show alert
            alert(`Loading trip ${tripId}...`);
        }
        
        async function toggleFavorite(tripId) {
            try {
                const response = await fetch(`/auth/api/trips/${tripId}/favorite`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    location.reload(); // Simple reload for now
                }
            } catch (error) {
                console.error('Toggle favorite error:', error);
            }
        }
        
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // Photo Analysis Results Modal Functions
        function showPhotoAnalysisResults(destinations) {
            let destinationsHtml = '';
            
            if (Array.isArray(destinations)) {
                destinations.forEach((dest, index) => {
                    if (typeof dest === 'string') {
                        destinationsHtml += `
                            <div class="destination-card">
                                <div class="destination-name">${dest}</div>
                                <div class="destination-actions">
                                    <button class="btn-create-trip" onclick="createTripFromDestination('${dest}', 'Europe')">
                                        <i class="fas fa-route"></i> Plan Trip Here
                                    </button>
                                </div>
                            </div>
                        `;
                    } else {
                        const confidence = dest.image_match_confidence || 'medium';
                        const reasons = dest.similarity_reasons ? dest.similarity_reasons.join(', ') : 'Similar visual features';
                        
                        destinationsHtml += `
                            <div class="destination-card ${confidence}-confidence">
                                <div class="destination-header">
                                    <div class="destination-name">${dest.destination || dest.name}</div>
                                    <div class="destination-country">${dest.country || 'Europe'}</div>
                                    <div class="confidence-badge confidence-${confidence}">${confidence} match</div>
                                </div>
                                <div class="destination-details">
                                    <div class="similarity-reasons">
                                        <strong>Why it matches:</strong> ${reasons}
                                    </div>
                                    ${dest.best_time_to_visit ? `<div class="best-time"><strong>Best time:</strong> ${dest.best_time_to_visit}</div>` : ''}
                                    ${dest.highlights && dest.highlights.length ? `<div class="highlights"><strong>Highlights:</strong> ${dest.highlights.join(', ')}</div>` : ''}
                                </div>
                                <div class="destination-actions">
                                    <button class="btn-create-trip" onclick="createTripFromDestination('${dest.destination || dest.name}', '${dest.country || 'Europe'}')">
                                        <i class="fas fa-route"></i> Plan Trip to ${dest.destination || dest.name}
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                });
            } else {
                destinationsHtml = `<div class="destination-card"><div class="destination-name">${destinations}</div></div>`;
            }
            
            const modal = document.createElement('div');
            modal.className = 'photo-analysis-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-camera"></i> AI Photo Analysis Results</h2>
                        <button class="modal-close" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p class="analysis-intro">Based on your photo, here are similar European destinations you might love:</p>
                        <div class="destinations-grid">
                            ${destinationsHtml}
                        </div>
                        <div class="create-custom-trip">
                            <button class="btn-custom-trip" onclick="createCustomTrip()">
                                <i class="fas fa-magic"></i> Create Custom Trip with All Destinations
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Store destinations for custom trip creation
            window.photoAnalysisDestinations = destinations;
        }
        
        function showErrorModal(message) {
            const modal = document.createElement('div');
            modal.className = 'photo-analysis-modal error-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-exclamation-triangle"></i> Analysis Failed</h2>
                        <button class="modal-close" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>${message}</p>
                        <button class="btn btn-primary" onclick="closeModal(this)">Try Again</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function closeModal(element) {
            const modal = element.closest('.photo-analysis-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Trip Creation Functions
        function createTripFromDestination(destination, country) {
            // Use user's current location or a default European city as start
            const startLocation = 'Paris, France'; // Could be improved to detect user location
            const endLocation = `${destination}, ${country}`;
            
            // Fill the form and submit
            document.getElementById('startLocation').value = startLocation;
            document.getElementById('endLocation').value = endLocation;
            
            // Close modal
            const modal = document.querySelector('.photo-analysis-modal');
            if (modal) modal.remove();
            
            // Smooth scroll to form
            document.getElementById('tripPlannerForm').scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
            
            // Highlight the form briefly
            const form = document.getElementById('tripPlannerForm');
            form.style.background = 'rgba(99, 102, 241, 0.1)';
            form.style.borderRadius = '20px';
            form.style.padding = '2rem';
            form.style.transition = 'all 0.3s ease';
            
            setTimeout(() => {
                form.style.background = '';
                form.style.padding = '';
            }, 3000);
        }
        
        function createCustomTrip() {
            if (!window.photoAnalysisDestinations || !Array.isArray(window.photoAnalysisDestinations)) {
                return;
            }
            
            // Take top 3 destinations and create a multi-city trip
            const top3 = window.photoAnalysisDestinations.slice(0, 3);
            const startLocation = 'Paris, France'; // Could be improved
            const endDestination = top3[top3.length - 1];
            const endLocation = typeof endDestination === 'string' ? 
                endDestination : 
                `${endDestination.destination || endDestination.name}, ${endDestination.country || 'Europe'}`;
            
            // Fill the form
            document.getElementById('startLocation').value = startLocation;
            document.getElementById('endLocation').value = endLocation;
            
            // Close modal
            const modal = document.querySelector('.photo-analysis-modal');
            if (modal) modal.remove();
            
            // Show message about the custom route
            const customMessage = document.createElement('div');
            customMessage.className = 'custom-trip-message';
            customMessage.innerHTML = `
                <div class="message-content">
                    <i class="fas fa-magic"></i>
                    <span>Creating a custom route through ${top3.length} destinations based on your photo!</span>
                    <button onclick="this.parentElement.parentElement.remove()">&times;</button>
                </div>
            `;
            
            document.body.appendChild(customMessage);
            
            setTimeout(() => {
                if (customMessage.parentElement) {
                    customMessage.remove();
                }
            }, 5000);
            
            // Scroll to form
            document.getElementById('tripPlannerForm').scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        }
        
        // History tab management
        function showHistoryTab(tabName) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.history-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.history-tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Load content based on tab
            if (tabName === 'preparations') {
                loadTripPreparations();
            } else if (tabName === 'searches') {
                loadSearchHistory();
            }
        }
        
        async function loadTripPreparations() {
            if (window.memoryManager) {
                await window.memoryManager.displayTripPreparations();
            }
        }
        
        async function loadSearchHistory() {
            if (window.memoryManager) {
                try {
                    const history = await window.memoryManager.getSearchHistory(10);
                    const container = document.getElementById('searchHistoryContainer');
                    
                    if (history.length === 0) {
                        container.innerHTML = '<p style="color: rgba(255,255,255,0.7); text-align: center;">No search history yet</p>';
                        return;
                    }
                    
                    const html = history.map(item => {
                        const results = item.search_results ? JSON.parse(item.search_results) : {};
                        return `
                            <div class="search-history-item" onclick="loadSearchResult('${item.id}')">
                                <h4>${item.search_query}</h4>
                                <p>Route types: ${results.route_types ? results.route_types.join(', ') : 'N/A'}</p>
                                <small>Searched: ${new Date(item.created_at).toLocaleDateString()}</small>
                            </div>
                        `;
                    }).join('');
                    
                    container.innerHTML = html;
                } catch (error) {
                    console.error('Failed to load search history:', error);
                }
            }
        }
        
        function loadSearchResult(searchId) {
            // Implementation to reload a previous search
            if (window.memoryManager) {
                window.memoryManager.showNotification('Loading search result...', 'info');
            }
        }
        
        // Auto-save trip preparation when form changes
        let autoSaveTimeout;
        function scheduleAutoSave() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                if (window.memoryManager) {
                    window.memoryManager.autoSaveTripPreparation();
                }
            }, 5000); // Auto-save after 5 seconds of inactivity
        }
        
        // AI Chat Widget Functions
        function toggleAiChat() {
            const chatPanel = document.getElementById('aiChatPanel');
            chatPanel.classList.toggle('active');
            
            if (chatPanel.classList.contains('active')) {
                // Focus on input when opening
                setTimeout(() => {
                    document.getElementById('aiChatInput').focus();
                }, 300);
            }
        }
        
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendAiMessage();
            }
        }
        
        async function sendAiMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addChatMessage('user', message);
            input.value = '';
            
            // Disable send button
            const sendBtn = document.querySelector('.chat-send');
            sendBtn.disabled = true;
            
            // Add loading message
            addChatMessage('ai', '🤖 Claude is thinking...', true);
            
            try {
                const response = await fetch('/api/ai-chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        context: 'main_page_chat'
                    })
                });
                
                const data = await response.json();
                
                // Remove loading message
                removeLoadingMessage();
                
                if (data.success) {
                    addChatMessage('ai', data.response);
                } else {
                    addChatMessage('ai', '😅 Sorry, I encountered an issue. Try asking about European destinations, travel tips, or let me help you plan your next adventure!');
                }
                
            } catch (error) {
                console.error('AI chat error:', error);
                removeLoadingMessage();
                addChatMessage('ai', '🛠️ I\'m having connectivity issues right now. But I\'d love to help you plan an amazing European adventure! Try the AI Travel Planner above for instant suggestions!');
            } finally {
                sendBtn.disabled = false;
            }
        }
        
        function addChatMessage(sender, message, isLoading = false) {
            const messagesContainer = document.getElementById('aiChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'ai' ? 'ai-message' : 'user-message';
            
            if (isLoading) {
                messageDiv.classList.add('loading-message');
            }
            
            const avatar = sender === 'ai' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    ${avatar}
                </div>
                <div class="message-content">
                    ${message}
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function removeLoadingMessage() {
            const loadingMessage = document.querySelector('.loading-message');
            if (loadingMessage) {
                loadingMessage.remove();
            }
        }
        
        // Enhanced initialization with memory management
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for memory manager to initialize
            setTimeout(() => {
                // Load initial trip preparations
                loadTripPreparations();
                
                // Set up auto-save for form inputs
                const startInput = document.getElementById('startLocation');
                const endInput = document.getElementById('endLocation');
                
                if (startInput) {
                    startInput.addEventListener('input', scheduleAutoSave);
                }
                if (endInput) {
                    endInput.addEventListener('input', scheduleAutoSave);
                }
                
                // Auto-save when route types change
                document.querySelectorAll('.route-type-card').forEach(card => {
                    const originalClick = card.onclick;
                    card.addEventListener('click', function() {
                        if (originalClick) originalClick.call(this);
                        scheduleAutoSave();
                    });
                });
                
                // Auto-open chat widget briefly to show it's available
                setTimeout(() => {
                    const chatToggle = document.querySelector('.chat-toggle');
                    if (chatToggle) {
                        chatToggle.style.animation = 'bounce 1s ease-in-out 3';
                    }
                }, 3000);
            }, 1000);
        });
    </script>
    
    <style>
        /* Photo Analysis Modal Styles */
        .photo-analysis-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 2rem;
        }
        
        .modal-content {
            background: white;
            border-radius: 24px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-header {
            padding: 2rem 2rem 1rem;
            border-bottom: 2px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #6366f1;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            color: #64748b;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .modal-close:hover {
            color: #ef4444;
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .analysis-intro {
            text-align: center;
            font-size: 1.1rem;
            color: #64748b;
            margin-bottom: 2rem;
        }
        
        .destinations-grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .destination-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            padding: 1.5rem;
            border-left: 4px solid #6366f1;
            transition: all 0.3s ease;
        }
        
        .destination-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.15);
        }
        
        .destination-card.high-confidence {
            border-left-color: #10b981;
        }
        
        .destination-card.medium-confidence {
            border-left-color: #f59e0b;
        }
        
        .destination-card.low-confidence {
            border-left-color: #6b7280;
        }
        
        .destination-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .destination-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
        }
        
        .destination-country {
            color: #64748b;
            font-size: 0.9rem;
        }
        
        .confidence-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .confidence-high {
            background: #dcfce7;
            color: #166534;
        }
        
        .confidence-medium {
            background: #fef3c7;
            color: #92400e;
        }
        
        .confidence-low {
            background: #f3f4f6;
            color: #374151;
        }
        
        .destination-details {
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .destination-details > div {
            margin-bottom: 0.5rem;
            color: #475569;
        }
        
        .destination-actions {
            text-align: center;
        }
        
        .btn-create-trip, .btn-custom-trip {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-create-trip:hover, .btn-custom-trip:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
        }
        
        .btn-custom-trip {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            font-size: 1.1rem;
            padding: 1rem 2rem;
        }
        
        .create-custom-trip {
            text-align: center;
            padding: 1.5rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 16px;
        }
        
        .custom-trip-message {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 10001;
            max-width: 400px;
        }
        
        .message-content {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
        }
        
        .message-content button {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            margin-left: auto;
        }
        
        /* Floating AI Chat Widget */
        .floating-ai-chat {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }
        
        .chat-toggle {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--brand-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-brand);
            transition: var(--transition-smooth);
            position: relative;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }
        
        .chat-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-brand-hover);
        }
        
        .chat-toggle i {
            color: var(--white);
            font-size: 2rem;
            animation: bounce 2s infinite;
        }
        
        .chat-pulse {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: var(--brand-gradient);
            animation: pulse 2s infinite;
            opacity: 0.7;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.2); opacity: 0.3; }
            100% { transform: scale(1.4); opacity: 0; }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }
        
        .chat-panel {
            position: absolute;
            bottom: 90px;
            right: 0;
            width: 400px;
            height: 500px;
            background: var(--bg-card);
            border-radius: var(--border-radius-xxl);
            box-shadow: var(--shadow-xl);
            border: var(--border-glass);
            backdrop-filter: blur(20px);
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-panel.active {
            display: flex;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .chat-header {
            background: var(--brand-gradient);
            color: var(--white);
            padding: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: var(--border-radius-xxl) var(--border-radius-xxl) 0 0;
        }
        
        .chat-title {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .chat-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition-normal);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background: var(--bg-primary);
        }
        
        .ai-message, .user-message {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            max-width: 85%;
        }
        
        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--brand-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .user-message .message-avatar {
            background: var(--gray-600);
        }
        
        .message-content {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 1rem;
            color: var(--text-primary);
            line-height: 1.5;
            box-shadow: var(--shadow-sm);
            border: var(--border-light);
        }
        
        .user-message .message-content {
            background: var(--brand-gradient);
            color: var(--white);
        }
        
        .chat-input-area {
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            display: flex;
            gap: 0.75rem;
            align-items: center;
            border-top: var(--border-light);
        }
        
        .chat-input {
            flex: 1;
            background: var(--bg-card);
            border: var(--border-medium);
            border-radius: var(--border-radius-lg);
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: var(--transition-normal);
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--brand-accent);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
        }
        
        .chat-input::placeholder {
            color: var(--text-secondary);
        }
        
        .chat-send {
            background: var(--brand-gradient);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-normal);
            color: var(--white);
        }
        
        .chat-send:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }
        
        .chat-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .floating-ai-chat {
                bottom: 1rem;
                right: 1rem;
            }
            
            .chat-toggle {
                width: 60px;
                height: 60px;
            }
            
            .chat-toggle i {
                font-size: 1.5rem;
            }
            
            .chat-panel {
                width: calc(100vw - 2rem);
                right: -1rem;
                height: 450px;
            }
            
            .photo-analysis-modal {
                padding: 1rem;
            }
            
            .modal-header, .modal-body {
                padding: 1rem;
            }
            
            .destinations-grid {
                gap: 1rem;
            }
            
            .destination-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
        }
    </style>
</body>
</html>